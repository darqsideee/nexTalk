<!DOCTYPE html>
<html lang="cs">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NEXUS | Future Communication</title>
    
    <!-- 1. TailwindCSS pro stylování -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- 2. Konfigurace Tailwindu pro vaše barvy -->
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        nexus: {
                            bg: '#0a0a0a',
                            dark: '#121212',
                            card: '#1a1a1a',
                            primary: '#7A4DFF',
                            accent: '#a855f7',
                            text: '#E4E4E4',
                            muted: '#71717a'
                        }
                    },
                    fontFamily: {
                        sans: ['Inter', 'sans-serif'],
                    },
                    animation: {
                        'fade-in': 'fadeIn 0.5s ease-out forwards',
                        'pulse-glow': 'pulseGlow 2s cubic-bezier(0.4, 0, 0.6, 1) infinite',
                    },
                    keyframes: {
                        fadeIn: {
                            '0%': { opacity: '0', transform: 'translateY(10px)' },
                            '100%': { opacity: '1', transform: 'translateY(0)' },
                        },
                        pulseGlow: {
                            '0%, 100%': { opacity: '1', boxShadow: '0 0 20px #7A4DFF' },
                            '50%': { opacity: '.5', boxShadow: '0 0 10px #7A4DFF' },
                        }
                    }
                }
            }
        }
    </script>

    <!-- 3. Import Map pro React a Lucide ikony (řeší chyby s importy) -->
    <script type="importmap">
        {
            "imports": {
                "react": "https://esm.sh/react@18.2.0",
                "react-dom/client": "https://esm.sh/react-dom@18.2.0/client",
                "lucide-react": "https://esm.sh/lucide-react@0.263.1"
            }
        }
    </script>
    
    <!-- 4. Babel pro kompilaci JSX v prohlížeči -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <!-- Google Font -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;800&display=swap" rel="stylesheet">

    <style>
        body { font-family: 'Inter', sans-serif; background-color: #0a0a0a; color: #E4E4E4; }
        /* Custom Scrollbar */
        ::-webkit-scrollbar { width: 6px; }
        ::-webkit-scrollbar-track { background: #0a0a0a; }
        ::-webkit-scrollbar-thumb { background: #333; border-radius: 10px; }
        ::-webkit-scrollbar-thumb:hover { background: #7A4DFF; }
        .glass { background: rgba(26, 26, 26, 0.7); backdrop-filter: blur(12px); border: 1px solid rgba(255, 255, 255, 0.08); }
    </style>
</head>
<body>
    <div id="root"></div>

    <!-- MAIN REACT APP LOGIC -->
    <script type="text/babel" data-type="module">
        import React, { useState, useEffect, useRef } from 'react';
        import { createRoot } from 'react-dom/client';
        import { 
            Zap, MessageSquare, Users, Phone, Settings, Hash, Heart, Share2, 
            Send, Plus, Search, Bell, LogOut, MoreHorizontal, Shield, User,
            Loader2, AlertCircle, CheckCircle
        } from 'lucide-react';

        // --- API CONFIGURATION ---
        const WORKER_URL = "https://komunikejsn.darqsideee.workers.dev";
        
        // Funkce pro volání vašeho workeru s fallbackem
        const nexusFetch = async (endpoint, options = {}) => {
            try {
                // Pokus o volání Workeru
                const response = await fetch(`${WORKER_URL}${endpoint}`, {
                    ...options,
                    headers: {
                        'Content-Type': 'application/json',
                        ...options.headers
                    }
                });
                
                if (!response.ok) throw new Error(`Server error: ${response.status}`);
                return await response.json();
            } catch (error) {
                console.warn(`Backend connection failed (${endpoint}), using mock data. Reason:`, error);
                
                // --- FALLBACK MOCK DATA (aby aplikace běžela i bez funkčního workeru) ---
                if (endpoint === '/api/login') {
                    await new Promise(r => setTimeout(r, 1000)); // Fake delay
                    return { 
                        token: 'mock-token', 
                        user: { 
                            username: 'Commander', 
                            avatar: 'https://api.dicebear.com/7.x/avataaars/svg?seed=Felix&backgroundColor=7A4DFF' 
                        } 
                    };
                }
                if (endpoint === '/api/feed') {
                    return [
                        { id: 1, user: 'System', content: 'Vítejte v Nexus. Spojení navázáno.', likes: 999, timestamp: new Date().toISOString() },
                        { id: 2, user: 'DarqSide', content: 'Worker backend implementován. Čekání na plnou synchronizaci.', likes: 42, timestamp: new Date().toISOString() }
                    ];
                }
                return [];
            }
        };

        // --- COMPONENTS ---

        const WelcomeScreen = ({ onNavigate }) => (
            <div className="min-h-screen relative overflow-hidden flex flex-col items-center justify-center text-center p-6">
                {/* Background Blobs */}
                <div className="absolute top-0 left-0 w-[500px] h-[500px] bg-nexus-primary rounded-full blur-[150px] opacity-20 -translate-x-1/2 -translate-y-1/2 pointer-events-none"></div>
                <div className="absolute bottom-0 right-0 w-[500px] h-[500px] bg-blue-600 rounded-full blur-[150px] opacity-10 translate-x-1/2 translate-y-1/2 pointer-events-none"></div>

                <div className="relative z-10 animate-fade-in max-w-4xl w-full">
                    <div className="flex justify-center mb-6">
                        <div className="w-20 h-20 bg-gradient-to-tr from-nexus-primary to-blue-500 rounded-3xl flex items-center justify-center shadow-[0_0_30px_rgba(122,77,255,0.5)] transform rotate-3 hover:rotate-6 transition-transform">
                            <Zap size={40} className="text-white fill-white" />
                        </div>
                    </div>
                    
                    <h1 className="text-5xl md:text-8xl font-black mb-6 tracking-tight leading-tight">
                        <span className="text-white">NEXUS</span>
                        <span className="text-transparent bg-clip-text bg-gradient-to-r from-nexus-primary to-purple-300">.OS</span>
                    </h1>
                    
                    <p className="text-xl md:text-2xl text-nexus-muted mb-12 max-w-2xl mx-auto font-light">
                        Next-gen komunikační protokol. <br/> 
                        <span className="text-nexus-primary font-medium">Bezpečný. Rychlý. Decentralizovaný.</span>
                    </p>

                    <div className="flex flex-col sm:flex-row gap-6 justify-center">
                        <button onClick={() => onNavigate('login')} className="px-10 py-4 bg-nexus-card border border-nexus-primary/30 text-white rounded-2xl font-bold text-lg hover:bg-nexus-primary/10 hover:border-nexus-primary transition-all shadow-[0_0_20px_rgba(122,77,255,0.1)]">
                            Přihlásit se
                        </button>
                        <button onClick={() => onNavigate('register')} className="px-10 py-4 bg-nexus-primary text-white rounded-2xl font-bold text-lg hover:bg-purple-600 transition-all shadow-[0_0_30px_rgba(122,77,255,0.4)] hover:shadow-[0_0_50px_rgba(122,77,255,0.6)]">
                            Vytvořit identitu
                        </button>
                    </div>

                    {/* Fake Stats */}
                    <div className="mt-20 grid grid-cols-3 gap-4 border-t border-white/5 pt-8">
                        <div>
                            <div className="text-2xl font-bold text-white">1.2M+</div>
                            <div className="text-xs text-nexus-muted uppercase tracking-widest">Uživatelů</div>
                        </div>
                        <div>
                            <div className="text-2xl font-bold text-nexus-primary">0ms</div>
                            <div className="text-xs text-nexus-muted uppercase tracking-widest">Latence</div>
                        </div>
                        <div>
                            <div className="text-2xl font-bold text-white">100%</div>
                            <div className="text-xs text-nexus-muted uppercase tracking-widest">Šifrování</div>
                        </div>
                    </div>
                </div>
            </div>
        );

        const AuthScreen = ({ mode, onNavigate, onLogin }) => {
            const [email, setEmail] = useState('');
            const [loading, setLoading] = useState(false);

            const handleSubmit = async (e) => {
                e.preventDefault();
                setLoading(true);
                // Volání workeru nebo mocku
                const data = await nexusFetch('/api/login', {
                    method: 'POST',
                    body: JSON.stringify({ email })
                });
                setLoading(false);
                if (data && data.user) {
                    onLogin(data.user);
                }
            };

            return (
                <div className="min-h-screen flex items-center justify-center p-4 relative overflow-hidden bg-nexus-bg">
                    <div className="absolute inset-0 bg-[radial-gradient(circle_at_center,_var(--tw-gradient-stops))] from-nexus-primary/20 via-nexus-bg to-nexus-bg pointer-events-none"></div>
                    
                    <div className="w-full max-w-md glass p-8 rounded-3xl relative z-10 animate-fade-in">
                        <button onClick={() => onNavigate('welcome')} className="absolute top-4 right-4 text-nexus-muted hover:text-white"><LogOut size={20}/></button>
                        
                        <div className="text-center mb-8">
                            <div className="w-16 h-16 bg-nexus-primary rounded-2xl mx-auto flex items-center justify-center mb-4 shadow-lg">
                                <Shield className="text-white" size={32} />
                            </div>
                            <h2 className="text-3xl font-bold text-white mb-2">{mode === 'login' ? 'Autentizace' : 'Registrace'}</h2>
                            <p className="text-nexus-muted text-sm">Zadejte své přihlašovací údaje pro přístup k síti.</p>
                        </div>

                        <form onSubmit={handleSubmit} className="space-y-5">
                            <div className="space-y-2">
                                <label className="text-xs font-bold text-nexus-muted uppercase ml-1">Email / ID</label>
                                <div className="relative group">
                                    <User className="absolute left-4 top-3.5 text-nexus-muted group-focus-within:text-nexus-primary transition-colors" size={20} />
                                    <input 
                                        type="text" 
                                        value={email}
                                        onChange={(e) => setEmail(e.target.value)}
                                        className="w-full bg-nexus-dark border border-white/10 rounded-xl py-3 pl-12 pr-4 text-white focus:outline-none focus:border-nexus-primary focus:ring-1 focus:ring-nexus-primary transition-all placeholder-gray-600" 
                                        placeholder="user@nexus.cloud" 
                                        required
                                    />
                                </div>
                            </div>

                            <div className="space-y-2">
                                <label className="text-xs font-bold text-nexus-muted uppercase ml-1">Heslo</label>
                                <div className="relative group">
                                    <Shield className="absolute left-4 top-3.5 text-nexus-muted group-focus-within:text-nexus-primary transition-colors" size={20} />
                                    <input type="password" className="w-full bg-nexus-dark border border-white/10 rounded-xl py-3 pl-12 pr-4 text-white focus:outline-none focus:border-nexus-primary focus:ring-1 focus:ring-nexus-primary transition-all placeholder-gray-600" placeholder="••••••••" />
                                </div>
                            </div>

                            <button 
                                type="submit" 
                                disabled={loading}
                                className="w-full bg-nexus-primary hover:bg-purple-600 text-white font-bold py-4 rounded-xl mt-4 transition-all shadow-[0_0_20px_rgba(122,77,255,0.3)] hover:shadow-[0_0_30px_rgba(122,77,255,0.5)] hover:scale-[1.02] flex items-center justify-center disabled:opacity-50 disabled:cursor-not-allowed"
                            >
                                {loading ? <Loader2 className="animate-spin" /> : 'Připojit se'}
                            </button>
                        </form>
                    </div>
                </div>
            );
        };

        const Dashboard = ({ user, onLogout }) => {
            const [posts, setPosts] = useState([]);
            const [loading, setLoading] = useState(true);
            const [activeTab, setActiveTab] = useState('feed');

            useEffect(() => {
                const fetchFeed = async () => {
                    setLoading(true);
                    const data = await nexusFetch('/api/feed');
                    setPosts(data);
                    setLoading(false);
                };
                fetchFeed();
            }, []);

            return (
                <div className="flex h-screen bg-nexus-bg overflow-hidden text-nexus-text font-sans">
                    {/* Sidebar */}
                    <aside className="w-20 md:w-72 bg-nexus-dark border-r border-white/5 flex flex-col z-20">
                        <div className="p-6 flex items-center gap-4">
                            <div className="w-10 h-10 bg-nexus-primary rounded-xl flex items-center justify-center shrink-0 shadow-lg">
                                <Zap className="text-white fill-white" size={20} />
                            </div>
                            <span className="font-bold text-xl tracking-wider hidden md:block">NEXUS</span>
                        </div>

                        <nav className="flex-1 px-4 space-y-2 mt-4">
                            {[
                                { id: 'feed', icon: Hash, label: 'Feed' },
                                { id: 'chat', icon: MessageSquare, label: 'Zprávy' },
                                { id: 'friends', icon: Users, label: 'Přátelé' },
                                { id: 'calls', icon: Phone, label: 'Hovory' },
                                { id: 'settings', icon: Settings, label: 'Nastavení' },
                            ].map(item => (
                                <button 
                                    key={item.id}
                                    onClick={() => setActiveTab(item.id)}
                                    className={`w-full flex items-center gap-4 p-3 rounded-xl transition-all group ${activeTab === item.id ? 'bg-nexus-primary/10 text-nexus-primary' : 'text-nexus-muted hover:bg-white/5 hover:text-white'}`}
                                >
                                    <item.icon size={24} className={activeTab === item.id ? 'stroke-nexus-primary' : ''} />
                                    <span className="font-medium hidden md:block">{item.label}</span>
                                    {activeTab === item.id && <div className="ml-auto w-1.5 h-1.5 bg-nexus-primary rounded-full hidden md:block shadow-[0_0_10px_#7A4DFF]"></div>}
                                </button>
                            ))}
                        </nav>

                        <div className="p-4 border-t border-white/5">
                            <div className="flex items-center gap-3 p-3 rounded-xl bg-white/5 hover:bg-white/10 transition-colors cursor-pointer border border-white/5">
                                <img src={user.avatar} className="w-10 h-10 rounded-full border border-nexus-primary" alt="User" />
                                <div className="hidden md:block overflow-hidden flex-1">
                                    <div className="font-bold text-sm truncate text-white">{user.username}</div>
                                    <div className="text-xs text-green-500 flex items-center gap-1">
                                        <div className="w-1.5 h-1.5 bg-green-500 rounded-full animate-pulse"></div> Online
                                    </div>
                                </div>
                                <button onClick={onLogout} className="text-nexus-muted hover:text-red-500 transition-colors"><LogOut size={18}/></button>
                            </div>
                        </div>
                    </aside>

                    {/* Main Content */}
                    <main className="flex-1 flex flex-col relative overflow-hidden">
                        {/* Header */}
                        <header className="h-16 glass flex items-center justify-between px-8 z-10">
                            <h2 className="text-xl font-bold capitalize text-white">{activeTab}</h2>
                            <div className="flex gap-4">
                                <button className="w-10 h-10 rounded-full bg-white/5 flex items-center justify-center hover:bg-white/10 transition-colors text-nexus-muted hover:text-white">
                                    <Search size={20} />
                                </button>
                                <button className="w-10 h-10 rounded-full bg-white/5 flex items-center justify-center hover:bg-white/10 transition-colors text-nexus-muted hover:text-white relative">
                                    <Bell size={20} />
                                    <span className="absolute top-2 right-2 w-2 h-2 bg-nexus-primary rounded-full"></span>
                                </button>
                            </div>
                        </header>

                        {/* Content Area */}
                        <div className="flex-1 overflow-y-auto p-4 md:p-8 relative">
                            {/* Feed Logic */}
                            {activeTab === 'feed' && (
                                <div className="max-w-2xl mx-auto space-y-6">
                                    {/* Status Bar */}
                                    <div className="flex gap-4 overflow-x-auto pb-4 no-scrollbar">
                                        <div className="flex flex-col items-center gap-2">
                                            <div className="w-16 h-16 rounded-full border-2 border-dashed border-nexus-muted flex items-center justify-center hover:border-nexus-primary hover:text-nexus-primary cursor-pointer transition-colors text-nexus-muted">
                                                <Plus size={24} />
                                            </div>
                                            <span className="text-xs text-nexus-muted">Add Story</span>
                                        </div>
                                        {[1,2,3].map(i => (
                                            <div key={i} className="flex flex-col items-center gap-2">
                                                <div className="w-16 h-16 rounded-full p-0.5 bg-gradient-to-tr from-nexus-primary to-blue-500">
                                                    <div className="w-full h-full rounded-full bg-nexus-bg p-0.5">
                                                        <img src={`https://api.dicebear.com/7.x/avataaars/svg?seed=${i}`} className="w-full h-full rounded-full bg-nexus-card" alt="story" />
                                                    </div>
                                                </div>
                                                <span className="text-xs text-nexus-muted">User {i}</span>
                                            </div>
                                        ))}
                                    </div>

                                    {/* Posts */}
                                    {loading ? (
                                        <div className="space-y-4">
                                            {[1,2].map(i => (
                                                <div key={i} className="h-64 rounded-2xl bg-white/5 animate-pulse"></div>
                                            ))}
                                        </div>
                                    ) : (
                                        posts.map((post, idx) => (
                                            <div key={idx} className="bg-nexus-card border border-white/5 rounded-2xl overflow-hidden animate-fade-in" style={{animationDelay: `${idx * 100}ms`}}>
                                                <div className="p-4 flex items-center justify-between">
                                                    <div className="flex items-center gap-3">
                                                        <div className="w-10 h-10 rounded-full bg-gradient-to-br from-nexus-primary to-blue-600 p-[1px]">
                                                            <div className="w-full h-full rounded-full bg-nexus-card flex items-center justify-center text-xs font-bold">
                                                                {post.user.substring(0,2).toUpperCase()}
                                                            </div>
                                                        </div>
                                                        <div>
                                                            <div className="font-bold text-white text-sm">{post.user}</div>
                                                            <div className="text-xs text-nexus-muted">2 hours ago</div>
                                                        </div>
                                                    </div>
                                                    <button className="text-nexus-muted hover:text-white"><MoreHorizontal/></button>
                                                </div>
                                                <div className="px-4 pb-3 text-sm text-gray-300">
                                                    {post.content}
                                                </div>
                                                <div className="h-64 bg-black/50 w-full flex items-center justify-center text-nexus-muted border-y border-white/5">
                                                    [MEDIA CONTENT: {post.id}]
                                                </div>
                                                <div className="p-4 flex gap-6">
                                                    <button className="flex items-center gap-2 text-nexus-muted hover:text-nexus-primary transition-colors"><Heart size={20}/> {post.likes}</button>
                                                    <button className="flex items-center gap-2 text-nexus-muted hover:text-white transition-colors"><MessageSquare size={20}/> 12</button>
                                                    <button className="flex items-center gap-2 text-nexus-muted hover:text-white transition-colors ml-auto"><Share2 size={20}/></button>
                                                </div>
                                            </div>
                                        ))
                                    )}
                                </div>
                            )}

                            {/* Placeholder for other tabs */}
                            {activeTab !== 'feed' && (
                                <div className="h-full flex flex-col items-center justify-center text-nexus-muted">
                                    <div className="w-24 h-24 rounded-full bg-white/5 flex items-center justify-center mb-6">
                                        {activeTab === 'chat' && <MessageSquare size={40}/>}
                                        {activeTab === 'settings' && <Settings size={40}/>}
                                        {activeTab === 'friends' && <Users size={40}/>}
                                        {activeTab === 'calls' && <Phone size={40}/>}
                                    </div>
                                    <h3 className="text-2xl font-bold text-white mb-2">Sekce ve výstavbě</h3>
                                    <p>Náš Cloudflare Worker zatím pro tuto sekci neposílá data.</p>
                                </div>
                            )}
                        </div>
                    </main>
                </div>
            );
        };

        const App = () => {
            const [view, setView] = useState('welcome');
            const [user, setUser] = useState(null);

            const handleLogin = (userData) => {
                setUser(userData);
                setView('dashboard');
            };

            const handleLogout = () => {
                setUser(null);
                setView('welcome');
            };

            return (
                <>
                    {view === 'welcome' && <WelcomeScreen onNavigate={setView} />}
                    {(view === 'login' || view === 'register') && <AuthScreen mode={view} onNavigate={setView} onLogin={handleLogin} />}
                    {view === 'dashboard' && <Dashboard user={user} onLogout={handleLogout} />}
                </>
            );
        };

        const root = createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
